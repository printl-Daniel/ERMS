@* Views/Employee/Edit.cshtml *@
@model ERMS.ViewModels.Employee.EmployeeEditViewModel
@{
    ViewBag.Title = "Edit Employee";

    string[] palette = { "#0181b0","#10b981","#f59e0b","#8b5cf6","#06b6d4","#ef4444","#ec4899","#6366f1" };
    int ci = 0; foreach (char c in (Model.FullName)) ci += c;
    var avatarBg = palette[ci % palette.Length];
    var parts    = Model.FullName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
    var initials = parts.Length >= 2
        ? $"{char.ToUpper(parts[0][0])}{char.ToUpper(parts[^1][0])}"
        : Model.FullName.Length > 0 ? char.ToUpper(Model.FullName[0]).ToString() : "?";
}

@section styles {
    <link rel="stylesheet" href="~/css/Employee.css" />
}

<div class="emp-page">

    @* ── Breadcrumb ──────────────────────────────────── *@
    <nav class="emp-bc">
        <a href="@Url.Action("Index","Employee")">Employees</a>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"/>
        </svg>
        <span>Edit</span>
    </nav>

    @* ── Flash messages ───────────────────────────────── *@
    @if (TempData["Success"] != null)
    {
        <div class="emp-flash emp-flash--success">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            @TempData["Success"]
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="emp-flash emp-flash--danger">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            @TempData["Error"]
        </div>
    }

    @* ── Page header ─────────────────────────────────── *@
    <div class="emp-edit-hd">
        <div class="emp-edit-identity">
            <div class="emp-edit-av" id="liveAvatar" style="background:@avatarBg">@initials</div>
            <div>
                <p class="emp-eyebrow">Editing Employee</p>
                <h1 class="emp-title" id="liveName">@Model.FullName</h1>
                <p class="emp-sub">ID &nbsp;#@Model.Id</p>
            </div>
        </div>
        <a href="@Url.Action("Index","Employee")" class="emp-btn emp-btn-outline">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to list
        </a>
    </div>

    @* ── Form ─────────────────────────────────────────── *@
    <form asp-action="Edit" asp-route-id="@Model.Id" method="post" novalidate>
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />

        @if (!ViewData.ModelState.IsValid)
        {
            <div class="emp-flash emp-flash--danger">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <div>
                    <strong>Please fix the following errors:</strong>
                    <div asp-validation-summary="ModelOnly"></div>
                </div>
            </div>
        }

        <div class="emp-edit-grid">

            @* ─── Card 1: Personal ───────────────────── *@
            <div class="emp-card">
                <div class="emp-card-header">
                    <span class="emp-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Personal Information
                    </span>
                </div>
                <div class="emp-card-body emp-form-body">

                    <div class="emp-form-row">
                        <div class="emp-field">
                            <label asp-for="FirstName" class="emp-label">
                                First Name <span class="emp-req">*</span>
                            </label>
                            <input asp-for="FirstName" id="FirstName"
                                   class="emp-input" placeholder="e.g. Sarah"
                                   autocomplete="given-name" />
                            <span asp-validation-for="FirstName" class="emp-field-err"></span>
                        </div>
                        <div class="emp-field">
                            <label asp-for="LastName" class="emp-label">
                                Last Name <span class="emp-req">*</span>
                            </label>
                            <input asp-for="LastName" id="LastName"
                                   class="emp-input" placeholder="e.g. Chen"
                                   autocomplete="family-name" />
                            <span asp-validation-for="LastName" class="emp-field-err"></span>
                        </div>
                    </div>

                    <div class="emp-form-row">
                        <div class="emp-field">
                            <label asp-for="Email" class="emp-label">
                                Email Address <span class="emp-req">*</span>
                            </label>
                            <div class="emp-input-wrap">
                                <svg class="emp-input-icon" viewBox="0 0 24 24" fill="none"
                                     stroke="currentColor" stroke-width="2"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                    <polyline points="22,6 12,13 2,6"/>
                                </svg>
                                <input asp-for="Email" type="email"
                                       class="emp-input emp-input--icon"
                                       placeholder="name@company.com"
                                       autocomplete="email" />
                            </div>
                            <span asp-validation-for="Email" class="emp-field-err"></span>
                        </div>
                        <div class="emp-field">
                            <label asp-for="PhoneNumber" class="emp-label">Phone Number</label>
                            <div class="emp-input-wrap">
                                <svg class="emp-input-icon" viewBox="0 0 24 24" fill="none"
                                     stroke="currentColor" stroke-width="2"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12 19.79 19.79 0 0 1 1.61 3.35 2 2 0 0 1 3.58 1h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 8.96a16 16 0 0 0 6.29 6.29l1.02-.92a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
                                </svg>
                                <input asp-for="PhoneNumber" type="tel"
                                       class="emp-input emp-input--icon"
                                       placeholder="+1 (555) 000-0000"
                                       autocomplete="tel" />
                            </div>
                            <span asp-validation-for="PhoneNumber" class="emp-field-err"></span>
                        </div>
                    </div>

                </div>
            </div>

            @* ─── Card 2: Employment ─────────────────── *@
            <div class="emp-card">
                <div class="emp-card-header">
                    <span class="emp-card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                        </svg>
                        Employment Details
                    </span>
                </div>
                <div class="emp-card-body emp-form-body">

                    <div class="emp-form-row">
                        <div class="emp-field">
                            <label asp-for="DepartmentId" class="emp-label">
                                Department <span class="emp-req">*</span>
                            </label>
                            <select asp-for="DepartmentId"
                                    asp-items="Model.Departments"
                                    class="emp-select">
                                <option value="">Select department…</option>
                            </select>
                            <span asp-validation-for="DepartmentId" class="emp-field-err"></span>
                        </div>
                        <div class="emp-field">
                            <label asp-for="PositionId" class="emp-label">
                                Position <span class="emp-req">*</span>
                            </label>
                            <select asp-for="PositionId"
                                    asp-items="Model.Positions"
                                    class="emp-select">
                                <option value="">Select position…</option>
                            </select>
                            <span asp-validation-for="PositionId" class="emp-field-err"></span>
                        </div>
                    </div>

                    <div class="emp-form-row">
                        <div class="emp-field">
                            <label asp-for="ManagerId" class="emp-label">Manager</label>
                            <select asp-for="ManagerId"
                                    asp-items="Model.Managers"
                                    class="emp-select">
                                <option value="">No manager (top-level)</option>
                            </select>
                            <span asp-validation-for="ManagerId" class="emp-field-err"></span>
                        </div>
                        <div class="emp-field">
                            <label asp-for="Status" class="emp-label">
                                Status <span class="emp-req">*</span>
                            </label>
                            <div class="emp-status-group">
                                @foreach (var opt in ERMS.ViewModels.Employee.EmployeeEditViewModel.StatusOptions)
                                {
                                    <label class="emp-status-chip @(opt.Value == Model.Status ? "emp-status-chip--on" : "")">
                                        <input type="radio" asp-for="Status"
                                               value="@opt.Value"
                                               class="emp-sr-only" />
                                        @opt.Text
                                    </label>
                                }
                            </div>
                            <span asp-validation-for="Status" class="emp-field-err"></span>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        @* ── Actions bar ──────────────────────────────── *@
        <div class="emp-form-actions">
            <a href="@Url.Action("Index","Employee")" class="emp-btn emp-btn-outline">
                Cancel
            </a>
            <button type="submit" class="emp-btn emp-btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                     stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                Save Changes
            </button>
        </div>

    </form>
</div>

@section scripts {
<script>
(function () {
    var palette = ["#0181b0","#10b981","#f59e0b","#8b5cf6","#06b6d4","#ef4444","#ec4899","#6366f1"];

    function getInitials(name) {
        var p = name.trim().split(/\s+/).filter(Boolean);
        return p.length >= 2
            ? (p[0][0] + p[p.length - 1][0]).toUpperCase()
            : (name.length ? name[0].toUpperCase() : '?');
    }
    function getBg(name) {
        var ci = 0;
        for (var i = 0; i < name.length; i++) ci += name.charCodeAt(i);
        return palette[ci % palette.length];
    }

    var firstEl  = document.getElementById('FirstName');
    var lastEl   = document.getElementById('LastName');
    var avatarEl = document.getElementById('liveAvatar');
    var nameEl   = document.getElementById('liveName');

    function syncHeader() {
        var full = ((firstEl.value || '') + ' ' + (lastEl.value || '')).trim();
        if (!full) return;
        avatarEl.textContent      = getInitials(full);
        avatarEl.style.background = getBg(full);
        nameEl.textContent        = full;
    }

    firstEl.addEventListener('input', syncHeader);
    lastEl.addEventListener('input',  syncHeader);

    // Status chip toggle
    document.querySelectorAll('.emp-status-chip').forEach(function (chip) {
        chip.addEventListener('click', function () {
            document.querySelectorAll('.emp-status-chip').forEach(function (c) {
                c.classList.remove('emp-status-chip--on');
            });
            this.classList.add('emp-status-chip--on');
        });
    });
}());
</script>
}
