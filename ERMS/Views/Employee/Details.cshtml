@model ERMS.ViewModels.Employee.EmployeeDetailsViewModel
@{
    ViewBag.Title = "Employee Details";
    // Initials for the avatar
    var initials = "";
    if (!string.IsNullOrEmpty(Model.FullName))
    {
        var parts = Model.FullName.Split(' ');
        initials = parts.Length >= 2
            ? $"{parts[0][0]}{parts[^1][0]}"
            : Model.FullName.Substring(0, Math.Min(2, Model.FullName.Length));
        initials = initials.ToUpper();
    }
}

<link rel="stylesheet" href="~/css/Employee.css" />

<div class="ep-wrap">

    <p class="ep-page-eyebrow">Employees</p>
    <h1 class="ep-page-title">Employee Profile</h1>

    <!-- ── Hero ── -->
    <div class="ep-card">
        <div class="ep-hero">
            <div class="ep-hero-left">
                <div class="ep-hero-avatar">@initials</div>
                <div>
                    <div class="ep-hero-name">@Model.FullName</div>
                    <div class="ep-hero-position">@Model.Position &nbsp;·&nbsp; @Model.Department</div>
                    <div class="ep-chips">
                        @if (Model.Status == "Active")
                        {
                            <span class="ep-chip ep-chip-success">
                                <span class="glyphicon glyphicon-ok" style="font-size:9px;"></span>
                                Active
                            </span>
                        }
                        else
                        {
                            <span class="ep-chip ep-chip-danger">
                                <span class="glyphicon glyphicon-remove" style="font-size:9px;"></span>
                                @Model.Status
                            </span>
                        }
                        <span class="ep-chip ep-chip-info">@Model.Role</span>
                    </div>
                </div>
            </div>

            <div class="ep-hero-actions">
                <a href="@Url.Action("Edit", "Employee", new { id = Model.Id })" class="btn btn-warning btn-sm">
                    <span class="glyphicon glyphicon-pencil"></span> Edit
                </a>
                <a href="@Url.Action("Index", "Employee")" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-arrow-left"></span> Back
                </a>
            </div>
        </div>

        <!-- ── Personal + Employment grid ── -->
        <div class="ep-info-grid">
            <!-- Personal -->
            <div class="ep-info-cell">
                <div class="ep-info-key">Full Name</div>
                <div class="ep-info-val">@Model.FullName</div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Username</div>
                <div class="ep-info-val"><code>@Model.Username</code></div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Email</div>
                <div class="ep-info-val">
                    <a href="mailto:@Model.Email">@Model.Email</a>
                </div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Phone</div>
                <div class="ep-info-val">@(Model.PhoneNumber ?? "—")</div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Department</div>
                <div class="ep-info-val">@Model.Department</div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Position</div>
                <div class="ep-info-val">@Model.Position</div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Reporting Manager</div>
                <div class="ep-info-val">@(Model.Manager ?? "—")</div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Hire Date</div>
                <div class="ep-info-val">@Model.HireDate.ToString("MMMM d, yyyy")</div>
            </div>
        </div>
    </div>

    <!-- ── Direct Reports ── -->
    @if (Model.Subordinates != null && Model.Subordinates.Any())
    {
        <div class="ep-card">
            <div class="ep-reports-head">
                <span class="ep-section-label">Direct Reports</span>
                <span class="ep-badge">@Model.Subordinates.Count</span>
            </div>

            <div class="ep-table-wrap">
                <table class="ep-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Email</th>
                            <th style="text-align:right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sub in Model.Subordinates)
                        {
                            <tr>
                                <td>
                                    <strong>@sub.FullName</strong>
                                </td>
                                <td>@sub.Position</td>
                                <td>
                                    <a href="mailto:@sub.Email">@sub.Email</a>
                                </td>
                                <td style="text-align:right;">
                                    <a href="@Url.Action("Details", "Employee", new { id = sub.Id })"
                                       class="btn btn-sm btn-info">
                                        <span class="glyphicon glyphicon-eye-open"></span> View
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }

    <!-- ── Audit Info ── -->
    <div class="ep-card">
        <div class="ep-info-grid">
            <div class="ep-info-cell">
                <div class="ep-info-key">Record Created</div>
                <div class="ep-info-val">@Model.CreatedAt.ToString("MMMM d, yyyy 'at' h:mm tt")</div>
            </div>
            <div class="ep-info-cell">
                <div class="ep-info-key">Last Modified</div>
                <div class="ep-info-val">
                    @(Model.UpdatedAt.HasValue
                                        ? Model.UpdatedAt.Value.ToString("MMMM d, yyyy 'at' h:mm tt")
                                        : "Never modified")
                </div>
            </div>
        </div>
    </div>

    <!-- ── Actions ── -->
    <div class="ep-actions">
        <a href="@Url.Action("Index", "Employee")" class="btn btn-default btn-lg">
            <span class="glyphicon glyphicon-list"></span> Employee List
        </a>
        <a href="@Url.Action("Edit", "Employee", new { id = Model.Id })" class="btn btn-warning btn-lg">
            <span class="glyphicon glyphicon-pencil"></span> Edit Employee
        </a>
    </div>

</div>
