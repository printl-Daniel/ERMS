@* Views/Hierarchy/OrgChart.cshtml *@
@model ERMS.ViewModels.Hierarchy.OrgChartViewModel

@{
    ViewData["Title"] = "Organization Chart";

    string[] avatarPalette = {
        "#0181b0","#10b981","#f59e0b","#8b5cf6",
        "#06b6d4","#ef4444","#ec4899","#6366f1"
    };

    string[] depthAccents = {
        "#0181b0","#10b981","#f59e0b","#8b5cf6","#06b6d4","#ef4444"
    };

    string AvatarBg(string name) {
        int ci = 0; foreach (char c in (name ?? "")) ci += c;
        return avatarPalette[ci % avatarPalette.Length];
    }

    string Initials(string name) {
        var p = (name ?? "?").Split(' ', StringSplitOptions.RemoveEmptyEntries);
        return p.Length >= 2
            ? $"{char.ToUpper(p[0][0])}{char.ToUpper(p[^1][0])}"
            : (name?.Length > 0 ? char.ToUpper(name[0]).ToString() : "?");
    }

    string DepthAccent(int depth) => depthAccents[depth % depthAccents.Length];
}

@section Styles {
    <link rel="stylesheet" href="~/css/Hierarchy.css" />
}

<div class="orgchart-page">

    <div class="orgchart-header">
        <div>
            <p class="orgchart-eyebrow">Organization</p>
            <h1 class="orgchart-title">
                <i class="fas fa-project-diagram"></i>
                @Model.Title
            </h1>
            <p class="orgchart-sub">
                @Model.TotalNodes employees across all departments
            </p>
        </div>
        <a asp-action="Index" class="btn-default">
            <i class="fas fa-list"></i>
            List View
        </a>
    </div>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible" role="alert">
            <i class="fas fa-exclamation-circle"></i>
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert">
                <i class="fas fa-times"></i>
            </button>
        </div>
    }

    @if (Model.ChartData != null && Model.ChartData.Any())
    {
        <div class="oc-scroll-wrap">
            <div class="oc-tree">
                @foreach (var root in Model.ChartData)
                {
                    @await Html.PartialAsync("_OrgChartNode", new ERMS.ViewModels.Hierarchy.OrgChartNodeViewModel {
                        Node   = root,
                        Depth  = 0
                    })
                }
            </div>
        </div>
    }
    else
    {
        <div class="oc-empty">
            <div class="oc-empty-icon"><i class="fas fa-project-diagram"></i></div>
            <h3 class="oc-empty-title">No chart data</h3>
            <p class="oc-empty-sub">The org chart has not been configured yet.</p>
        </div>
    }
</div>
